{% extends 'common/Base.html' %}
{% block content %}

<div class="container" style="margin-top:10px;">

    <div class="border bg-light" >
        <form class="needs-validation" action="/CreateList" method="post" enctype="multipart/form-data" style="padding: 10px;">
            <div class="form-group">
                {% csrf_token %}
            </div>  
            <div class="form-group">
          
                <label for="listupload-div" style="padding: 5px;">Create list from an excel file</label>
             
                <div class="input-group">
                    <div class="custom-file">
                      <input type="file" class="custom-file-input" id="inputGroupFile04" aria-describedby="inputGroupFileAddon04">
                      <label class="custom-file-label" for="inputGroupFile04">Choose file</label>
                    </div>
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary" type="button" id="inputGroupFileAddon04">Upload</button>
                    </div>
                  </div>
            </div> 
        </form>
    </div>

<div class="border"  style="padding: 10px;margin-top:20px;">
    <h3>Define your List</h3>
    <div>
        <form class="needs-validation" novalidate action="/CreateList" method="POST" id='NewListForm'>
            <div class="form-group">
                {% csrf_token %}
            </div>
            <div class="form-group mb-3">
                <label for="listname" style="padding: 5px;"> List name </label>
                <input type="text" class="form-control" id='listname' name='Listname' placeholder="List name" required/>
                <div class="invalid-feedback">Field cannot be empty.</div>
            </div>
            <div class="form-group mb-3">
                <label for="listdescription" style="padding: 5px;"> List Description </label>
                <textarea class="form-control" id='listdescription' name='Listdescription' placeholder="List Description" required></textarea>
                <div class="invalid-feedback">Field cannot be empty.</div>
            </div>
            <!--
            <div class="row" id="list-columns">
                <div class="col">
                  <input type="text" class="form-control" placeholder="Column title" aria-label="Column title" name="col_title">
                </div>
                <div class="col">
                  <textarea class="form-control" placeholder="Description" aria-label="col_description" name="col_description"></textarea>
                </div>
                <div class="col">
                    <select class="form-select" aria-label="col_datatype" name="col_datatype">
                        <option selected>Select data type</option>
                        <option value="text">Text</option>
                        <option value="number">Number</option>
                        <option value="date">Date</option>
                        <option value="select">Select</option>
                      </select>
                  </div>
                  <div class="col">
                    <select class="form-select" aria-label="col_filtertype" name="col_filtertype">
                        <option selected>Select filter type</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                      </select>                  
                    </div>
                  <div class="col">
                    <button class="btn btn-primary" type="button" id="listupload_button" onclick=AddColumn()>+</button>
                    <button class="btn btn-primary" type="button" id="listupload_button" onclick=RemoveColumn()>X</button>
                  </div>
              </div>
                -->
              <div class="form-footer mb-3">
                <button class="btn btn-primary" type="submit" id="listupload_button">Create</button>
              </div>
        </form>
    </div>
</div>

</div>

<script type="text/javascript">
    var colidvar = 0;
    $(document).ready(function() { 
            AddColumn();
            
    });

    function AddColumn(){
        var html = '<div class="row mb-3" id="list-column_'+colidvar+'">'+
                        
                            '<input type="hidden" name="Id_'+colidvar+'" value="'+colidvar+'">'+
                        
                        '<div class="col">'+
                            '<input type="text" class="form-control" placeholder="Column title" aria-label="Column title" name="col_title_'+colidvar+'"required>'+
                            '<div class="invalid-feedback">Field cannot be empty.</div>'+
                        '</div>'+
                        '<div class="col">'+
                            '<textarea class="form-control" placeholder="Description" aria-label="col_description" style= "height: 100%;" name="col_description_'+colidvar+'"></textarea>'+
                        '</div>'+
                        '<div class="col">'+
                            '<label for="col_datatype_'+colidvar+'">Field type</label>'+
                            '<select class="form-control" aria-label="col_datatype" id="col_datatype_'+colidvar+'" name="col_datatype_'+colidvar+'"required>'+
                                '<option value="text">Short text</option>'+
                                '<option value="textarea">Long text</option>'+
                                '<option value="number">Number</option>'+
                                '<option value="date">Date</option>'+
                                '<option value="select">List</option>'+
                            '</select>'+
                        '</div>'+
                        '<div class="col" style="display:none;" name="col_datatype_'+colidvar+'_options_div">'+
                            '<label for="col_datatype_'+colidvar+'_options">Options</label>'+
                            '<select class="form-control" multiple="multiple" id = "col_datatype_'+colidvar+'_options" name="col_datatype_'+colidvar+'_options">'+
                                
                            '</select>'+
                            '<div class="invalid-feedback">Field cannot be empty.</div>'+
                        '</div>'+
                        '<div class="col">'+
                            '<label for="col_datatype_'+colidvar+'">Filter type</label>'+
                            '<select class="form-control" aria-label="col_filtertype" id ="col_filtertype_'+colidvar+'" name="col_filtertype_'+colidvar+'" required>'+
                                '<option value="select">Single selection</option>'+
                                '<option value="multi_select">Multi selection</option>'+
                                '<option value="text">Text</option>'+
                                '<option value="date">Date</option>'+
                                '<option value="range_number">Number range</option>'+
                                '<option value="range_date">Date range</option>'+
                            '</select>'+
                        '</div>'+
                        '<div class="col">'+
                            '<button class="btn btn-primary" style="margin-right:10px" type="button" id="listupload_button" onclick=AddColumn()>+</button>'+
                            '<button class="btn btn-primary" type="button" id="listupload_button_'+colidvar+'" onclick=RemoveColumn(this)>X</button>'+
                        '</div>'+
                    '</div>'
              $('#NewListForm div:last').before(html);
        
        
        

        $('select[name^="col_datatype_'+colidvar+'"]').change(function(){
                                
                                if($(this).find('option:selected').attr('value') == "select"){
                                            
                                            $("[name='"+$(this).attr('name')+"_options_div']").show();
                                            $("[name='"+$(this).attr('name')+"_options']").attr("required", true);
                                    }
                                else{
                                            
                                            $("[name='"+$(this).attr('name')+"_options']").attr("required", false);
                                            $("[name='"+$(this).attr('name')+"_options_div']").hide();
                                    }
            });
            
            $('[name="col_datatype_'+colidvar+'_options"]').select2({
                        tags: "true",
                        placeholder: "Add options",
                        tokenSeparators: [','],
                        allowClear: true
            });
        
            bootstrapValidate('[name="col_title_'+colidvar+'"]', 'regex:^[A-Za-z0-9][A-Za-z0-9 ]\*[A-Za-z0-9]\*$:Special charachters not allowed!');
            colidvar++;

    };

    function RemoveColumn($this){
        console.log( $($this)); 
        $($this).parent('div').parent('div').remove();
    };


</script>

<script>
    (function() {
      'use strict';
      window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
          form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false) {
                console.log(form.checkValidity());
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add('was-validated');
          }, false);
        });
      }, false);
    })();
</script>
 {% endblock %}